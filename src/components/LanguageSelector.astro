---
interface Props { currentLang: string; }
const { currentLang } = Astro.props;

const LANGS: [string, string, string][] = [
  ['ro','RO','ðŸ‡·ðŸ‡´'], ['en','EN','ðŸ‡¬ðŸ‡§'], ['de','DE','ðŸ‡©ðŸ‡ª'],
  ['fr','FR','ðŸ‡«ðŸ‡·'], ['es','ES','ðŸ‡ªðŸ‡¸'], ['it','IT','ðŸ‡®ðŸ‡¹'],
  ['pl','PL','ðŸ‡µðŸ‡±'], ['pt','PT','ðŸ‡µðŸ‡¹'], ['hu','HU','ðŸ‡­ðŸ‡º'],
  ['cs','CS','ðŸ‡¨ðŸ‡¿'], ['sk','SK','ðŸ‡¸ðŸ‡°'], ['bg','BG','ðŸ‡§ðŸ‡¬'],
  ['hr','HR','ðŸ‡­ðŸ‡·'], ['lt','LT','ðŸ‡±ðŸ‡¹'], ['lv','LV','ðŸ‡±ðŸ‡»'],
  ['et','ET','ðŸ‡ªðŸ‡ª'], ['mt','MT','ðŸ‡²ðŸ‡¹'], ['sl','SL','ðŸ‡¸ðŸ‡®'],
  ['sv','SV','ðŸ‡¸ðŸ‡ª'], ['da','DA','ðŸ‡©ðŸ‡°'], ['nl','NL','ðŸ‡³ðŸ‡±'],
  ['el','EL','ðŸ‡¬ðŸ‡·'], ['fi','FI','ðŸ‡«ðŸ‡®'], ['ga','GA','ðŸ‡®ðŸ‡ª'],
];

const current = LANGS.find(([l]) => l === currentLang) ?? ['en','EN','ðŸ‡¬ðŸ‡§'];
---
<div class="relative" id="lang-selector">
  <button
    id="lang-btn"
    aria-haspopup="listbox"
    aria-expanded="false"
    class="flex items-center gap-1.5 h-8 px-2 rounded-md text-[13px] font-medium t-fg border t-border cursor-pointer hover:opacity-80 transition-opacity"
    title="Select language"
  >
    <span class="text-base leading-none" aria-hidden="true">{current[2]}</span>
    <span class="font-semibold tracking-wide">{current[1]}</span>
    <svg class="w-3 h-3 opacity-40" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M19 9l-7 7-7-7"/></svg>
  </button>

  <ul
    id="lang-menu"
    role="listbox"
    aria-label="Select language"
    class="absolute right-0 top-full mt-1.5 z-50 hidden rounded-lg shadow-xl overflow-y-auto py-1 t-bg-surface border t-border"
    style="width: 88px; max-height: 280px;"
  >
    {LANGS.map(([loc, code, flag]) => (
      <li role="option" aria-selected={loc === currentLang}>
        <a
          href={`/${loc}/`}
          class={`flex items-center gap-2 px-3 py-1.5 text-[13px] hover:opacity-100 transition-opacity ${loc === currentLang ? 't-primary font-semibold' : 't-fg opacity-70'}`}
        >
          <span class="text-base leading-none" aria-hidden="true">{flag}</span>
          <span class="font-medium">{code}</span>
        </a>
      </li>
    ))}
  </ul>
</div>

<script is:inline>
(function() {
  var btn = document.getElementById('lang-btn');
  var menu = document.getElementById('lang-menu');
  if (btn) btn.addEventListener('click', function(e) {
    e.stopPropagation();
    var open = menu ? menu.classList.toggle('hidden') === false : false;
    btn.setAttribute('aria-expanded', String(open));
  });
  document.addEventListener('click', function() {
    if (menu) menu.classList.add('hidden');
    if (btn) btn.setAttribute('aria-expanded', 'false');
  });
})();
</script>
