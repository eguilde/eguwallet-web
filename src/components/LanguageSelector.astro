---
interface Props { currentLang: string; }
const { currentLang } = Astro.props;

// [locale, 2-letter display code, flag file (ISO 3166-1 alpha-2)]
const LANGS: [string, string, string][] = [
  ['ro','RO','ro'], ['en','EN','gb'], ['de','DE','de'],
  ['fr','FR','fr'], ['es','ES','es'], ['it','IT','it'],
  ['pl','PL','pl'], ['pt','PT','pt'], ['hu','HU','hu'],
  ['cs','CS','cz'], ['sk','SK','sk'], ['bg','BG','bg'],
  ['hr','HR','hr'], ['lt','LT','lt'], ['lv','LV','lv'],
  ['et','ET','ee'], ['mt','MT','mt'], ['sl','SL','si'],
  ['sv','SV','se'], ['da','DA','dk'], ['nl','NL','nl'],
  ['el','EL','gr'], ['fi','FI','fi'], ['ga','GA','ie'],
];

const current = LANGS.find(([l]) => l === currentLang) ?? ['en','EN','gb'];
---
<div class="relative" id="lang-selector">
  <button
    id="lang-btn"
    aria-haspopup="listbox"
    aria-expanded="false"
    class="flex items-center gap-1.5 h-8 px-2 rounded-md text-[13px] font-medium t-fg border t-border cursor-pointer hover:opacity-80 transition-opacity"
    title="Select language"
  >
    <img src={`/assets/flags/${current[2]}.svg`} alt="" width="20" height="15" class="rounded-sm object-cover flex-shrink-0" style="width:20px;height:15px;" aria-hidden="true" />
    <span class="font-semibold tracking-wide">{current[1]}</span>
    <svg class="w-3 h-3 opacity-40 flex-shrink-0" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M19 9l-7 7-7-7"/></svg>
  </button>

  <ul
    id="lang-menu"
    role="listbox"
    aria-label="Select language"
    class="absolute right-0 top-full mt-1.5 z-50 hidden rounded-lg shadow-xl overflow-y-auto py-1 t-bg-surface border t-border"
    style="width:90px; max-height:280px;"
  >
    {LANGS.map(([loc, code, flag]) => (
      <li role="option" aria-selected={loc === currentLang}>
        <a
          href={`/${loc}/`}
          class={`flex items-center gap-2 px-2.5 py-1.5 text-[13px] hover:opacity-100 transition-opacity ${loc === currentLang ? 't-primary font-semibold' : 't-fg opacity-70'}`}
        >
          <img src={`/assets/flags/${flag}.svg`} alt="" width="20" height="15" class="rounded-sm object-cover flex-shrink-0" style="width:20px;height:15px;" loading="lazy" aria-hidden="true" />
          <span class="font-medium">{code}</span>
        </a>
      </li>
    ))}
  </ul>
</div>

<script is:inline>
(function() {
  var btn = document.getElementById('lang-btn');
  var menu = document.getElementById('lang-menu');
  if (btn) btn.addEventListener('click', function(e) {
    e.stopPropagation();
    var open = menu ? menu.classList.toggle('hidden') === false : false;
    btn.setAttribute('aria-expanded', String(open));
  });
  document.addEventListener('click', function() {
    if (menu) menu.classList.add('hidden');
    if (btn) btn.setAttribute('aria-expanded', 'false');
  });
})();
</script>
